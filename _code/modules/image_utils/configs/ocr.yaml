# ============================================================================
# ImageOCR - Complete Configuration Example
# ============================================================================
# 모든 가능한 정책 옵션을 포함한 전체 예제입니다.
# 실제 사용시에는 필요한 항목만 선택하여 사용하세요.

ocr:
  # --------------------------------------------------------------------------
  # 1. Source - 소스 이미지 설정
  # --------------------------------------------------------------------------
  source:
    path: "input/document.jpg"
    must_exist: false
    convert_mode: "RGB"
  
  # --------------------------------------------------------------------------
  # 2. Provider - OCR 제공자 설정
  # --------------------------------------------------------------------------
  provider:
    provider: "paddle"                  # OCR 제공자: paddle, tesseract 등
    langs: ["ch", "en"]                 # 언어 코드 목록
    min_conf: 0.5                       # 최소 신뢰도 (0.0-1.0)
    
    # PaddleOCR 전용 설정
    paddle_device: "cpu"                # 디바이스: cpu, gpu
    paddle_use_angle_cls: true          # 각도 분류 사용
    paddle_instance: null               # 캐시된 인스턴스 (내부 사용)
  
  # --------------------------------------------------------------------------
  # 3. Preprocess - OCR 전처리 설정
  # --------------------------------------------------------------------------
  preprocess:
    max_width: null                     # OCR용 최대 너비 (리사이즈)
  
  # --------------------------------------------------------------------------
  # 4. Postprocess - OCR 후처리 설정
  # --------------------------------------------------------------------------
  postprocess:
    strip_special_chars: true           # 특수문자 제거
    filter_alphanumeric: true           # 영숫자만 있는 텍스트 필터링
    deduplicate_iou_threshold: 0.7      # 중복 제거 IoU 임계값
    prefer_lang_order: ["ch", "en"]     # 언어 우선순위
  
  # --------------------------------------------------------------------------
  # 5. Save - 이미지 저장 설정 (FSO 기반)
  # --------------------------------------------------------------------------
  save:
    save_copy: false                    # OCR 결과 이미지 저장 (보통 false)
    directory: "output/ocr"
    
    name:
      as_type: "file"
      prefix: null
      name: ""
      suffix: "_ocr"
      tail: null
      extension: null
      delimiter: "_"
      tail_mode: "counter"
      date_format: "%Y-%m-%d"
      counter_width: 3
      auto_expand: true
      tail_suffix: null
      sanitize: true
      case: "keep"
      ensure_unique: true
    
    ops:
      as_type: "file"
      exist:
        must_exist: false
        create_if_missing: true
        overwrite: false
      ext:
        require_ext: false
        default_ext: null
        allowed_exts: null
    
    format: null
    quality: 95
  
  # --------------------------------------------------------------------------
  # 6. Meta - 메타데이터 저장 설정 (OCR 결과 포함)
  # --------------------------------------------------------------------------
  meta:
    save_meta: true                     # OCR 결과 JSON 저장
    directory: null
    
    name:
      as_type: "file"
      prefix: null
      name: ""
      suffix: "_ocr"                    # OCR 메타 접미사
      tail: null
      extension: ".json"
      delimiter: "_"
      tail_mode: null
      date_format: "%Y-%m-%d"
      counter_width: 3
      auto_expand: true
      tail_suffix: null
      sanitize: true
      case: "keep"
      ensure_unique: false
    
    ops:
      as_type: "file"
      exist:
        must_exist: false
        create_if_missing: true
        overwrite: true
      ext:
        require_ext: false
        default_ext: ".json"
        allowed_exts: null
  
  # --------------------------------------------------------------------------
  # 7. Log - 로그 설정
  # --------------------------------------------------------------------------
  log:
    name: "image_ocr"                   # ✨ 서비스 이름 (filter 격리용)
    level: "INFO"
    format: "<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <level>{message}</level>"
    colorize: true
    serialize: false
    backtrace: false
    diagnose: false
    enqueue: false
    catch: true
    
    handlers:
      - sink: "output/logs/image_ocr_{time:YYYY-MM-DD}.log"
        level: "DEBUG"
        format: "{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {message}"
        rotation: "1 day"
        retention: "7 days"
        compression: "zip"
        encoding: "utf-8"
        colorize: false
        serialize: false
        backtrace: true
        diagnose: false
        enqueue: false
        catch: true
